# ============================
# ğŸš€ æ„å»ºé˜¶æ®µ (ç¼–è¯‘ Go ä»£ç )
# ============================
FROM golang:1.23 AS builder

# è®¾ç½® Go ä»£ç†ï¼ˆé˜²æ­¢å›½å†…è®¿é—®ä¸äº†ï¼‰
ENV GOPROXY=https://goproxy.cn,direct

WORKDIR /app

# å¤åˆ¶ go.mod å’Œ go.sumï¼ˆåˆ©ç”¨ Docker ç¼“å­˜ï¼‰
COPY go.mod go.sum ./
RUN go mod tidy

# å¤åˆ¶å½“å‰å¾®æœåŠ¡ä»£ç 
COPY . .

# è¿›è¡Œé™æ€ç¼–è¯‘ï¼Œé˜²æ­¢è¿è¡Œæ—¶æŠ¥ `no such file or directory`
RUN CGO_ENABLED=0 GOOS=linux go build -o /app/user .

# ============================
# ğŸƒ è¿è¡Œé˜¶æ®µ (åŸºäº CentOS)
# ============================
FROM centos:latest

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /root/

# å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä¿®æ­£è·¯å¾„ï¼‰
COPY --from=builder /app/user /user

# èµ‹äºˆæ‰§è¡Œæƒé™ï¼ˆç¡®ä¿æ–‡ä»¶å¯æ‰§è¡Œï¼‰
RUN chmod +x /user

# è¿è¡Œ Go æœåŠ¡
CMD ["/user"]
